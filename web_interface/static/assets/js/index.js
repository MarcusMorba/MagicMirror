// hide scrollbar
$("body").css("overflow", "hidden");

var era;
var imgLoadInterval;
var timelineArr = [];    //a list of instances of all timeline

var socket = io.connect('http://' + document.domain + ':' + location.port);
socket.on('connect', function() {
    console.log("SocketIO: Connected");
});

socket.on('start_animation', function(msg){
    console.log("start animation.", msg);
    era = msg;
    flashLights();
    //displayCircle (300, 600,200);
    windowTimeline();
    setTimeout(loadMotionGraphics, 5000);
    imgLoadInterval = setInterval(loadImages, 6000);
});

socket.on('stop_animation', function(){
    console.log("stop animation");

    stopAnimation();
});

 windowTimeline();

function stopAnimation(){

    flashLights();
    //remove all elements generated by mo.js
    var all_element = document.querySelectorAll('[data-name]');
    var bodyChild = []
    for (var i=0; i< all_element.length; i++){
        if(all_element[i].parentNode.nodeName == 'BODY')
             bodyChild.push(all_element[i]);
                  
    } 

    TweenMax.to(bodyChild, 1, {opacity : 0, delay: 1});
    
    //clear images
    clearInterval(imgLoadInterval);

    
    // remove SVG
    var layer1 = document.getElementById("Layer_1");
    while (layer1.firstChild) {
        layer1.removeChild(layer1.firstChild);
    }

    //clear canvas
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    clearInterval(animFlag);

    setTimeout(function(){
        //console.log("all_element.length",all_element.length )
        for (var j=0; j< bodyChild.length; j++){
            try{
                document.body.removeChild(bodyChild[j]);      
            }catch(err){
                console.log("err from removing child from document body");
            }
           
        } 
    },2000);
}


function loadMotionGraphics(){
	dotMatrix(1500, 150, 0, true);
	dotMatrix(1000, 950, 6, true);
	dotMatrix(200, 400, 3, false);
	
	threeRect(800, 800);
	twoSkewRect(300, 900);
	twoSkewRect(260, 930);
	
	dotCross(1500, 800);
	
	halfCircle(1900,800,90, false);
	twoHalfCircles(1600, 250);
	
	rotatingCross(600, 300);
	
	lineAndDots();
	sineWaveInit();

    generateSVG(era);
}


